# Тестирование ИИ-агентов

## Обзор

Тесты разработаны для оценки способности ИИ-агентов использовать инструменты в различных сценариях. Особое внимание уделяется проактивному использованию инструментов, когда ИИ-агент должен самостоятельно определить, какой инструмент использовать.

## Структура тестов

- `tests/utils/` - вспомогательные утилиты для тестирования
  - `testContext.ts` - создание тестового контекста с in-memory LowDB

- `tests/ai-interaction/` - тесты для взаимодействия ИИ-агентов с инструментами
  - `get-knowledges.test.ts` - проверка использования инструмента getKnowledges
  - `tool-chain.test.ts` - проверка использования цепочки инструментов
  - `proactive-tool-usage.test.ts` - проверка проактивного выбора инструментов

## Запуск тестов

```bash
# Запуск всех тестов
yarn test

# Запуск только тестов взаимодействия с ИИ
yarn test:ai

# Запуск тестов в режиме отслеживания изменений
yarn test:watch
yarn test:ai:watch
```

## Ключевые аспекты тестирования

### In-memory LowDB

Тесты используют in-memory версию LowDB для изоляции тестовой среды:

```typescript
const adapter = new MemoryAdapter<LowDbData>();
const db = new Low<LowDbData>(adapter, initialData);
```

### Мокирование OpenAI API

OpenAI API мокируется для контроля поведения ИИ-агента:

```typescript
const openaiMock = {
  chat: {
    completions: {
      create: jest.fn(),
    },
  },
};
context.openai = openaiMock as any;
```

### Симуляция многошаговых диалогов

Тесты моделируют многошаговые диалоги, где ИИ-агент должен последовательно использовать разные инструменты:

1. Пользователь отправляет запрос
2. ИИ использует инструмент A
3. Результат возвращается к ИИ
4. ИИ использует инструмент B
5. Результат возвращается к ИИ
6. ИИ формирует финальный ответ

## Проблемные области

- **Проактивное использование инструментов**: ИИ-агент не всегда самостоятельно выбирает использование инструмента `getKnowledges`, даже когда запрос явно требует информации из базы знаний.

- **Цепочки инструментов**: ИИ-агент может прерывать цепочку инструментов, не доводя её до логического завершения.

## Рекомендации по улучшению

1. **Улучшение описаний инструментов**: Детальные описания помогают ИИ понять, когда использовать определённый инструмент.

2. **Контекстные подсказки**: В системном промпте можно добавить подсказки о том, как определять ситуации, требующие использования определённых инструментов.

3. **Инструкции для обработки сообщений**: Добавление чётких инструкций о том, как обрабатывать запросы, требующие информации из базы знаний.
